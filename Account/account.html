<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="../style/style.css">
        <link rel="stylesheet" href="../style/Account/style_account.css">
        <title>HealthNorth - Accueil</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="HealthNorth - Leader de la santé depuis 1987">
    </head>

    <body>
        <header id="headerAccount">
        </header>

        <h1>Votre espace personnel</h1>

        <div class="container">
            <div class="rdv">
                <h2>Vos rendez-vous à venir</h2>
                <div class="rdvModif">
                    <p>Prochain rendez-vous à Date et Lieu avec le Nom Docteur</p>
                    <a class="bouton" href="appointment_change.html"> Modifier le rendez-vous</a>
                </div>
            </div>

            <div class="dossier">
                <h2>Votre dossier</h2>
                <div class="progres">
                    <p class="legend">Complété à X%</p>
                    <progress id="progresDossier" max="100" value="50"></progress>
                </div>
                <p>Continuez à compléter votre profil pour gagner du temps lors de vos prochains rendez-vous et nous aider à mieux vous prendre en charge</p>
            </div>

            <div class="prescriptions">
                <h2>Vos prescriptions</h2>
                <div class="prescription">
                    <p>Prescription du Date par le Nom Docteur</p>
                    <a class="bouton" href="prescription.html"> Accéder à la prescription</a>
                </div>
            </div>

            <div class="appliMobile">
                <div>
                    <h2 class="left">Téléchargez notre appli mobile pour accéder facilement à votre espace à tout moment</h2>
                    <p>Scannez ce QR code avec votre téléphone pour accéder directement au lien de téléchargement</p>
                </div>
                <div>
                    <img class="QR" src="../images/Placeholder.png">
                </div>
            </div>
        </div>

        <footer id="siteFooter">
        </footer>
        
                <!-- Header de ma page -->
        <script>
            fetch("headerAccount.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("headerAccount").innerHTML = data;
            })
            .catch(error => console.error("Erreur lors du chargement du header :", error));
        </script>
        
                <!-- Footer de ma page -->
        <script>
            fetch("../Company/footer.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("siteFooter").innerHTML = data;
            })
        </script>

        <script>
            // Vérifie si l'utilisateur est connecté et a le rôle correct
            const token = localStorage.getItem('jwt');

            if (!token) {
                // Pas connecté
                alert("Vous devez être connecté pour accéder à cette page.");
                window.location.href = "../Company/connexion.html";
            } else {
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    const roles = payload.roles || [];

                    // Vérifie le rôle
                    if (!roles.includes('ROLE_PATIENT')) {
                        alert("Vous n'êtes pas autorisé à accéder à cette page.");
                        window.location.href = "../Company/connexion.html";
                    }

                } catch (e) {
                    console.error("JWT invalide :", e);
                    localStorage.removeItem('jwt');
                    window.location.href = "../Company/connexion.html";
                }
            }
        </script>

        <script src="../js/authHeaderFooter.js"></script>
        <script>
            initPage({
                headerPath: "headerAccount.html",
                footerPath: "../Company/footer.html",
                allowedRoles: ['ROLE_PATIENT']
            });
        </script>

    </body>
</html>